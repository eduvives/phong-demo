<!DOCTYPE html>
<!-- python -m SimpleHTTPServer -->
<!-- http://localhost:8000/phong.html -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>WebGL - Phong Shading</title>
<link href='css/colorpicker.css' type='text/css' rel='stylesheet'/>
<link href='css/jquery-ui-1.8.13.custom.css' type='text/css' rel='stylesheet' />
<link href='css/style.css' type='text/css' rel='stylesheet' />
<script type='text/javascript' src='js/jquery-1.5.1.min.js'></script>
<script type='text/javascript' src='js/jquery-ui-1.8.13.custom.min.js'></script>
<script type='text/javascript' src='js/colorpicker.js'></script>
<script type="text/javascript" src="js/renderer.js"></script>

<script type="text/javascript" src="js/three.min.js"></script>


<script type="text/javascript">
var renderer = 0;

function run() {
  var id = document.getElementById("select_example_id").value;
  $("#select_num_colors").hide();
  //var vertSrc = document.getElementById("code_vert").text;
  var vertSrc = document.getElementById("GouraudVert").value;
  var fragSrc = document.getElementById("GouraudFrag").value;

  document.getElementById("code_frag").value = fragSrc;
  document.getElementById("code_vert").value = vertSrc;
  renderer = new Renderer("myWebGLCanvas", vertSrc, fragSrc);

  var zoom = $('#slider-zoom').slider("value");
  var near = $('#slider-near').slider("value");
  var far = $('#slider-far').slider("value");
  renderer.init(zoom,near,far);
  $('#slider-zoom-value').html(zoom);
  $('#slider-near-value').html(near);
  $('#slider-far-value').html(far);
}

function updateRenderer() {
  var vertSrc = document.getElementById("code_vert").value;
  var fragSrc = document.getElementById("code_frag").value;

  renderer.updateShader(vertSrc, fragSrc);  
  renderer.display();
}

function showNumColorSelect(){
  var d = document.getElementById("select_example_id").value;
  if(d==3){
    $("#select_num_colors").show();
  }else{
    $("#select_num_colors").hide();
  } 
}

function showDirectionSelect(){
  var d = document.getElementById("select_light_id").value;
  if(d==2){
    var x = document.getElementsByClassName("light");
    var i;
    for (i = 0; i < x.length; i++) {
        x[i].style.display = 'none';
    }
    var x = document.getElementsByClassName("direction");
    var i;
    for (i = 0; i < x.length; i++) {
        x[i].style.display = 'table-cell';
    }
  }else{
    var x = document.getElementsByClassName("direction");
    var i;
    for (i = 0; i < x.length; i++) {
        x[i].style.display = 'none';
    }
    var x = document.getElementsByClassName("light");
    var i;
    for (i = 0; i < x.length; i++) {
        x[i].style.display = 'table-cell';
    }
  } 
}

var interval = setInterval(timerFunc, 40);

function timerFunc() {
  var offset = 1.0;
  renderer.t += offset;
  renderer.display();
}

function numColorsChanged() {
  var d = parseFloat(document.getElementById("select_num_colors").value);
  renderer.tones = d;
  renderer.specularTones = d / 2;
}

function modeChanged() {
  var d = document.getElementById("select_id").value;
  renderer.modeVal = d;
}

function modelChanged() {
  var d = document.getElementById("select_id2").value;

  var zoom = $('#slider-zoom').slider("value");
  var near = $('#slider-near').slider("value");
  var far = $('#slider-far').slider("value");
  renderer.updateModel(d,zoom,near,far);
  $('#slider-zoom-value').html(zoom);
  $('#slider-near-value').html(near);
  $('#slider-far-value').html(far);

  //renderer.updateModel('./plane.txt',zoom,near,far);
  //renderer.updateModel('./hose.txt',zoom,near,far);
  //renderer.updateModel('./teapot.txt',zoom,near,far);
  renderer.display();


  /* Texture */
  renderer.loadTexture("vacio");
}

function exampleChanged() {
  var d = parseInt(document.getElementById("select_example_id").value);
  switch(d)
  {
    default:
    case 1:
      document.getElementById("code_frag").value = document.getElementById("GouraudFrag").value;
      document.getElementById("code_vert").value = document.getElementById("GouraudVert").value;
      break;
    case 2:
      document.getElementById("code_frag").value = document.getElementById("PhongFrag").value;
      document.getElementById("code_vert").value = document.getElementById("PhongVert").value;
      break;
    case 3:
      document.getElementById("code_frag").value = document.getElementById("ToonFrag").value;
      document.getElementById("code_vert").value = document.getElementById("ToonVert").value;
      break;
    case 4:
      document.getElementById("code_frag").value = document.getElementById("PhongTextureFrag").value;
      document.getElementById("code_vert").value = document.getElementById("PhongTextureVert").value;
      break;
    case 5:
      document.getElementById("code_frag").value = document.getElementById("NormalMappingFrag").value;
      document.getElementById("code_vert").value = document.getElementById("NormalMappingVert").value;
      break;
  }
  updateRenderer();
  showNumColorSelect()
}

function lightChanged() {
  var d = parseInt(document.getElementById("select_light_id").value) - 1;
  renderer.lightType = d;
  showDirectionSelect();
}

</script>
</head>
<body onload="run();">
<p id="code_vert_error" ></p>
<p id="code_frag_error" ></p></td></tr>
<table>
<tr style="vertical-align:top;">
<td><canvas id="myWebGLCanvas" width="600" height="400">Your browser does not support the canvas element</canvas><br>
<select onchange="exampleChanged()" id="select_example_id">
  <option value="1">Gouraud Shading</option>
  <option value="2">Phong Shading</option>
  <option value="3">Toon Shading</option>
  <option value="4">Phong Texture Shading</option>
</select>
<select onchange="numColorsChanged()" id="select_num_colors">
  <option value="2">2 Colors</option>
  <option selected value="4">4 Colors</option>
  <option value="8">8 Colors</option>
</select>
<select onchange="modelChanged()" id="select_id2">
  <option value="./knot.txt">Knot</option>
  <option value="./cube.txt">Cube</option>
  <option value="./plane.txt">Plane</option>
  <option value="./sphere.txt">Sphere</option>
  <option value="./hose.txt">Hose</option>
  <option value="./teapot.txt">Teapot</option>
</select>
<select onchange="modeChanged()" id="select_id">
  <option value="1">normal mode</option>
  <option value="2">ambient only</option>
  <option value="3">diffuse only</option>
  <option value="4">specular only</option>
</select>
<select onchange="lightChanged()" id="select_light_id">
  <option value="1">Puntual</option>
  <option value="2">Directional</option>
  <option value="3">Spotlight</option>
</select>
<button onclick="updateRenderer()">Reload Shader Code</button>

<table>
 <tr>
  <td align='right'>Ambient reflection (ka):</td><td id='slider-ka-value' width='30px'>1.0</td><td><div id='slider-ka'/></td>
  <td align='right'>Ambient color:</td><td colspan='2'><div id='colorSelectorAmbient' class='colorSelector'><div style='background-color:rgb(52,26,0)'></div></div></td>
  <td colspan="2">&nbsp;</td>
  <td class='light'>Light position:</td>
  <td class='direction'>Direction:</td>
 </tr>
 <tr>
  <td align='right'>Diffuse reflection (kd):</td><td id='slider-kd-value'  width='30px'>1.0</td><td><div id='slider-kd'/></td>
  <td align='right'>Diffuse Color:</td><td colspan='2'><div id='colorSelectorDiffuse' class='colorSelector'><div style='background-color:rgb(204,102,0)'></div></div></td>
  <td class='light' align='right' width="30px">X:</td><td class='light' id='slider-x-value' width='30px' align='center'>1</td><td class='light' width='150px'><div id='slider-x'/></td>
  <td class='direction' align='right' width="30px">X:</td><td class='direction' id='direction-x-value' width='30px' align='center'>0.4</td><td class='direction' width='150px'><div id='direction-x'/></td>
 </tr>
 <tr>
  <td align='right'>Specular reflection (ks):</td><td id='slider-ks-value'  width='30px'>1.0</td><td><div id='slider-ks'/></td>
  <td align='right'>Specular Color:</td><td colspan='2'><div id='colorSelectorSpecular' class='colorSelector'><div style='background-color:rgb(256,256,256)'></div></div></td>
  <td class='light' align='right'>Y:</td><td class='light' id='slider-y-value'  width='30px' align='center'>1</td><td class='light' width='150px'><div id='slider-y'/></td>
  <td class='direction' align='right'>Y:</td><td class='direction' id='direction-y-value' width='30px' align='center'>0.3</td><td class='direction' width='150px'><div id='direction-y'/></td>
 </tr>
 <tr>
  <td align='right'>Shininess:</td><td id='slider-s-value' width='30px'>80</td><td width='150px'><div id='slider-s'/></td>
  <td>&nbsp;Background Color:</td><td colspan='2'><div id='colorSelectorBg' class='colorSelector'><div style='background-color:rgb(0,102,179)'></div></div></td>
  <td class='light' align='right'>Z:</td> <td class='light' id='slider-z-value'  width='30px' align='center'>-1</td><td class='light' width='150px'><div id='slider-z'/></td>
  <td class='direction' align='right' >Z:</td> <td class='direction' id='direction-z-value'  width='30px' align='center'>0.6</td><td class='direction' width='150px'><div id='direction-z'/></td>
 </tr>
</table>

<table>
 <tr>
  <td>Perspective:</td>
 </tr>
 <tr>
  <td align='right' width="135px">Vertical Angle (Zoom) :</td><td id='slider-zoom-value' width='30px'>32</td><td width='150px'><div id='slider-zoom'/></td>
 </tr>
 <tr>
  <td align='right'>Near Plane :</td><td id='slider-near-value'  width='30px'>0.5</td><td width='150px'><div id='slider-near'/></td>
 </tr>
 <tr>
  <td align='right'>Far Plane :</td> <td id='slider-far-value'  width='30px'>4</td><td width='150px'><div id='slider-far'/></td>
 </tr>
</table>

</td>
<td>
<h3>Vertex Shader</h3>
<textarea cols="55" rows="40" class="code_input" id="code_vert" wrap="off"></textarea><br>
<h3>Fragment Shader</h3>
<textarea cols="55" rows="40" class="code_input" id="code_frag" wrap="off"></textarea><br>
</td>

</table>

<script>
$('#slider-s').slider({value:80, min:1, max:128, step:1, range:"min", slide:updateShininess});
$('#slider-ka').slider({value:1, max:1, step:0.01, range:"min", slide:updateLightAmbientTerm});
$('#slider-kd').slider({value:1, max:1, step:0.01, range:"min", slide:updateLightDiffuseTerm});
$('#slider-ks').slider({value:1, max:1, step:0.01, range:"min", slide:updateLightSpecularTerm});
$('#slider-x').slider({value:1, min:-10, max:10, step:0.1, slide:updateLight, change:updateLight});
$('#slider-y').slider({value:1, min:-10, max:10, step:0.1, slide:updateLight, change:updateLight});
$('#slider-z').slider({value:-1, min:-10, max:10, step:0.1, slide:updateLight, change:updateLight});
$('#direction-x').slider({value:0.4, min:0, max:1, step:0.01, slide:updateDirection, change:updateDirection});
$('#direction-y').slider({value:0.3, min:0, max:1, step:0.01, slide:updateDirection, change:updateDirection});
$('#direction-z').slider({value:0.6, min:0, max:1, step:0.01, slide:updateDirection, change:updateDirection});
$('#slider-zoom').slider({value:32, min:0, max:180, step:1, slide:updatePerspective, change:updatePerspective});
$('#slider-near').slider({value:0.5, min:0, max:5, step:0.1, slide:updatePerspective, change:updatePerspective});
$('#slider-far').slider({value:4, min:0, max:10, step:0.1, slide:updatePerspective, change:updatePerspective});

// Mostrar los valores actuales en las etiquetas de los Sliders
updateLight();
updateDirection();
lightChanged();

function updateShininess(event, ui){
  renderer.shininess = ui.value;
  $('#slider-s-value').html(ui.value);
}
function updateLightAmbientTerm(event, ui){
  renderer.kaVal = ui.value;
  $('#slider-ka-value').html(ui.value);
}
function updateLightDiffuseTerm(event, ui){
  renderer.kdVal = ui.value;
  $('#slider-kd-value').html(ui.value);
}
function updateLightSpecularTerm(event, ui){
  renderer.ksVal = ui.value;
  $('#slider-ks-value').html(ui.value);
}

function updateLight(){
  var x = $('#slider-x').slider("value");
  var y = $('#slider-y').slider("value");
  var z = $('#slider-z').slider("value");
  renderer.lightPos = [x,y,z];
  $('#slider-x-value').html(x);
  $('#slider-y-value').html(y);
  $('#slider-z-value').html(z);
}

function updateDirection(){
  var x = $('#direction-x').slider("value");
  var y = $('#direction-y').slider("value");
  var z = $('#direction-z').slider("value");
  renderer.direction = [x,y,z];
  $('#direction-x-value').html(x);
  $('#direction-y-value').html(y);
  $('#direction-z-value').html(z);
}

function updatePerspective(){
  var zoom = $('#slider-zoom').slider("value");
  var near = $('#slider-near').slider("value");
  var far = $('#slider-far').slider("value");
  renderer.updatePerspective(zoom,near,far);
  $('#slider-zoom-value').html(zoom);
  $('#slider-near-value').html(near);
  $('#slider-far-value').html(far);
}

function updateClearColor(r,g,b){
  clearColor = [r,g,b,1.0];
}

$('#colorSelectorAmbient').ColorPicker({
  onSubmit: function(hsb, hex, rgb, el) {
    $(el).val(hex);
    $(el).ColorPickerHide();
  },
  color: '#341900',
  onShow: function (colpkr) {
    $(colpkr).fadeIn(500);
    return false;
  },
  onHide: function (colpkr) {
    $(colpkr).fadeOut(500);
    return false;
  },
  onChange: function (hsb, hex, rgb) {
    $('#colorSelectorAmbient div').css('backgroundColor', '#' + hex);
    renderer.ambientColor = [rgb.r/256, rgb.g/256, rgb.b/256];
  },
  onBeforeShow: function (colpkr) {
    $(colpkr).ColorPickerSetColor('rgb(0.2,0.1,0.0)');
  }
})

$('#colorSelectorDiffuse').ColorPicker({
  onSubmit: function(hsb, hex, rgb, el) {
    $(el).val(hex);
    $(el).ColorPickerHide();
  },
  color: '#cc6600',
  onShow: function (colpkr) {
    $(colpkr).fadeIn(500);
    return false;
  },
  onHide: function (colpkr) {
    $(colpkr).fadeOut(500);
    return false;
  },
  onChange: function (hsb, hex, rgb) {
    $('#colorSelectorDiffuse div').css('backgroundColor', '#' + hex);
    renderer.diffuseColor = [rgb.r/256,rgb.g/256,rgb.b/256];
  },
  onBeforeShow: function (colpkr) {
    $(colpkr).ColorPickerSetColor('rgb(0.8,0.4,0.0)');
  }
})

$('#colorSelectorSpecular').ColorPicker({
  onSubmit: function(hsb, hex, rgb, el) {
    $(el).val(hex);
    $(el).ColorPickerHide();
  },
  color: '#ffffff',
  onShow: function (colpkr) {
    $(colpkr).fadeIn(500);
    return false;
  },
  onHide: function (colpkr) {
    $(colpkr).fadeOut(500);
    return false;
  },
  onChange: function (hsb, hex, rgb) {
    $('#colorSelectorSpecular div').css('backgroundColor', '#' + hex);
    renderer.specularColor = [rgb.r/256,rgb.g/256,rgb.b/256];
  },
  onBeforeShow: function (colpkr) {
    $(colpkr).ColorPickerSetColor('rgb(1.0,1.0,1.0)');
  }
})

$('#colorSelectorBg').ColorPicker({
  onSubmit: function(hsb, hex, rgb, el) {
   $(el).val(hex);
   $(el).ColorPickerHide();
 },
 color: '#0065b3',
 onShow: function (colpkr) {
   $(colpkr).fadeIn(500);
  return false;
  },
  onHide: function (colpkr) {
    $(colpkr).fadeOut(500);
    return false;
  },
  onChange: function (hsb, hex, rgb) {
    $('#colorSelectorBg div').css('backgroundColor', '#' + hex);
    renderer.clearColor = [rgb.r/256,rgb.g/256,rgb.b/256];
  },
  onBeforeShow: function (colpkr) {
    $(colpkr).ColorPickerSetColor('rgb(0.0,0.4,0.7)');
  }
})
</script>

<p>Based on a 
<a href=http://multivis.net/lecture/phong.html>http://multivis.net/lecture/phong.html</a> | 
<a target="_blank"
  href="http://www.mathematik.uni-marburg.de/~thormae/lectures/graphics1/code/WebGLShaderLightMat/ShaderLightMat.html">WebGL applet</a> by <a
  href="http://www.uni-marburg.de/fb12/grafikmultimedia-en/team/thormae-en" target="_blank">Prof. Thorsten Thorm&auml;hlen</a>.
  Modified by <a href="http://wwwcg.in.tum.de/group/persons/kehrer.html" target="_blank">Johannes Kehrer</a> for educational purpose.</p>


<textarea id="PhongTextureVert" style="display: none;">
attribute vec3 position;
attribute vec3 normal;
attribute vec2 texCoord;
uniform mat4 projection, modelview, normalMat;
varying vec3 normalInterp;
varying vec3 vertPos;
varying vec2 vUv;

void main(){
  vec4 vertPos4 = modelview * vec4(position, 1.0);
  vertPos = vec3(vertPos4) / vertPos4.w;
  normalInterp = vec3(normalMat * vec4(normal, 0.0));
  vUv = texCoord;

  gl_Position = projection * vertPos4;
}
</textarea>
  
<textarea id="PhongTextureFrag" style="display: none;">
precision mediump float;
varying vec3 normalInterp;  // Surface normal
varying vec3 vertPos;       // Vertex position
uniform int mode;   // Rendering mode
uniform float Ka;   // Ambient reflection coefficient
uniform float Kd;   // Diffuse reflection coefficient
uniform float Ks;   // Specular reflection coefficient
uniform float shininessVal; // Shininess
// Material color
uniform vec3 ambientColor;
uniform vec3 diffuseColor;
uniform vec3 specularColor;
uniform vec3 lightPos; // Light position
// New light attributes
uniform int lightType;
uniform vec3 direction;
uniform sampler2D texture;
varying vec2 vUv;

void main() {
  vec3 texturaYa = texture2D( texture, vUv ).xyz;
  vec3 N = normalize(normalInterp);
  vec3 L;

  if(lightType == 0){
    L = normalize(lightPos - vertPos);
  } else {
    L = normalize(-direction);
  }
  
  // Lambert's cosine law
  float lambertian = max(dot(N, L), 0.0);
  float specular = 0.0;
  if(lambertian > 0.0) {
    vec3 R = reflect(-L, N);      // Reflected light vector
    vec3 V = normalize(-vertPos); // Vector to viewer
    // Compute the specular term
    float specAngle = max(dot(R, V), 0.0);
    specular = pow(specAngle, shininessVal);
  }
  gl_FragColor = vec4(Ka * ambientColor +
                      Kd * lambertian * (texturaYa) +
                      Ks * specular * specularColor, 1.0);

  // only ambient
  if(mode == 2) gl_FragColor = vec4(Ka * ambientColor, 1.0);
  // only diffuse
  if(mode == 3) gl_FragColor = vec4(Kd * lambertian * diffuseColor, 1.0);
  // only specular
  if(mode == 4) gl_FragColor = vec4(Ks * specular * specularColor, 1.0);
  }
</textarea>

<textarea id="PhongVert" style="display: none;">
attribute vec3 position;
attribute vec3 normal;
uniform mat4 projection, modelview, normalMat;
varying vec3 normalInterp;
varying vec3 vertPos;

void main(){
  vec4 vertPos4 = modelview * vec4(position, 1.0);
  vertPos = vec3(vertPos4) / vertPos4.w;
  normalInterp = vec3(normalMat * vec4(normal, 0.0));
  gl_Position = projection * vertPos4;
}
</textarea>

<textarea id="PhongFrag" style="display: none;">
precision mediump float;
varying vec3 normalInterp;  // Surface normal
varying vec3 vertPos;       // Vertex position
uniform int mode;   // Rendering mode
uniform float Ka;   // Ambient reflection coefficient
uniform float Kd;   // Diffuse reflection coefficient
uniform float Ks;   // Specular reflection coefficient
uniform float shininessVal; // Shininess
// Material color
uniform vec3 ambientColor;
uniform vec3 diffuseColor;
uniform vec3 specularColor;
uniform vec3 lightPos; // Light position
// New light attributes
uniform int lightType;
uniform vec3 direction;

void main() {
  vec3 N = normalize(normalInterp);
  vec3 L;

  if(lightType == 0){
    L = normalize(lightPos - vertPos);
  } else {
    L = normalize(-direction);
  }
  
  // Lambert's cosine law
  float lambertian = max(dot(N, L), 0.0);
  float specular = 0.0;
  if(lambertian > 0.0) {
    vec3 R = reflect(-L, N);      // Reflected light vector
    vec3 V = normalize(-vertPos); // Vector to viewer
    // Compute the specular term
    float specAngle = max(dot(R, V), 0.0);
    specular = pow(specAngle, shininessVal);
  }
  gl_FragColor = vec4(Ka * ambientColor +
                      Kd * lambertian * diffuseColor +
                      Ks * specular * specularColor, 1.0);

  // only ambient
  if(mode == 2) gl_FragColor = vec4(Ka * ambientColor, 1.0);
  // only diffuse
  if(mode == 3) gl_FragColor = vec4(Kd * lambertian * diffuseColor, 1.0);
  // only specular
  if(mode == 4) gl_FragColor = vec4(Ks * specular * specularColor, 1.0);
}
</textarea>

<textarea id="GouraudVert" style="display: none;">
attribute vec3 position;
attribute vec3 normal;
uniform mat4 projection, modelview, normalMat;
varying vec3 normalInterp;
varying vec3 vertPos;
uniform int mode;   // Rendering mode
uniform float Ka;   // Ambient reflection coefficient
uniform float Kd;   // Diffuse reflection coefficient
uniform float Ks;   // Specular reflection coefficient
uniform float shininessVal; // Shininess
// Material color
uniform vec3 ambientColor;
uniform vec3 diffuseColor;
uniform vec3 specularColor;
uniform vec3 lightPos; // Light position
varying vec4 color; //color
// New light attributes
uniform int lightType;
uniform vec3 direction;

void main(){
  vec4 vertPos4 = modelview * vec4(position, 1.0);
  vertPos = vec3(vertPos4) / vertPos4.w;
  normalInterp = vec3(normalMat * vec4(normal, 0.0));
  gl_Position = projection * vertPos4;

  vec3 N = normalize(normalInterp);
  vec3 L;

  if(lightType == 0){
    L = normalize(lightPos - vertPos);
  } else {
    L = normalize(-direction);
  }

  // Lambert's cosine law
  float lambertian = max(dot(N, L), 0.0);
  float specular = 0.0;
  if(lambertian > 0.0) {
    vec3 R = reflect(-L, N);      // Reflected light vector
    vec3 V = normalize(-vertPos); // Vector to viewer
    // Compute the specular term
    float specAngle = max(dot(R, V), 0.0);
    specular = pow(specAngle, shininessVal);
  }
  color = vec4(Ka * ambientColor +
               Kd * lambertian * diffuseColor +
               Ks * specular * specularColor, 1.0);

  // only ambient
  if(mode == 2) color = vec4(Ka * ambientColor, 1.0);
  // only diffuse
  if(mode == 3) color = vec4(Kd * lambertian * diffuseColor, 1.0);
  // only specular
  if(mode == 4) color = vec4(Ks * specular * specularColor, 1.0);
}
</textarea>

<textarea id="GouraudFrag" style="display: none;">
precision mediump float;

varying vec4 color;
void main() {
  gl_FragColor = color;
}

</textarea>

<textarea id="ToonVert" style="display: none;">
attribute vec3 position;
attribute vec3 normal;
uniform mat4 projection, modelview, normalMat;
varying vec3 normalInterp;
varying vec3 vertPos;

void main(void) {
            
    // Vertex position
    vec4 vertPos4 = modelview * vec4(position, 1.0);
    vertPos = vec3(vertPos4) / vertPos4.w;
    gl_Position = projection * vertPos4;

    // Vertex normal
    normalInterp = vec3(normalMat * vec4(normal, 0.0));
}
</textarea>
  
<textarea id="ToonFrag" style="display: none;">
precision mediump float; // set float to medium precision
        
// light properties
uniform vec3 ambientColor; // the light's ambient color
uniform vec3 diffuseColor; // the light's diffuse color
uniform vec3 specularColor; // the light's specular color
uniform vec3 lightPos; // the light's position

// New light attributes
uniform int lightType;
uniform vec3 direction;

// material properties
uniform float Ka; // the ambient reflectivity
uniform float Kd; // the diffuse reflectivity
uniform float Ks; // the specular reflectivity
uniform float shininessVal; // the specular exponent
uniform float uTones; // number of tones
uniform float uSpecularTones; // number of specular tones

// geometry properties
varying vec3 vertPos; // world xyz of fragment - Vertex position
varying vec3 normalInterp; // normal of fragment - Surface normal

uniform int mode;   // Rendering mode

void main(void) {
        
    // ambient term
    vec3 ambient = Ka * ambientColor; 
            
    // diffuse term
    vec3 normal = normalize(normalInterp); 
    vec3 light;

    if(lightType == 0){
      light = normalize(lightPos - vertPos);
    } else {
      light = normalize(-direction);
    }

    float lambert = max(0.0, dot(normal,light));
    float tone = floor(lambert * uTones);
    lambert = tone / uTones;
    vec3 diffuse = Kd * diffuseColor * lambert; // diffuse term
            
    // specular term
    vec3 R = reflect(-light, normal);      // Reflected light vector
    vec3 V = normalize(-vertPos); // Vector to viewer
    float highlight = pow(max(0.0, dot(R, V)),shininessVal);
    tone = floor(highlight * uSpecularTones);
    highlight = tone / uSpecularTones;
    vec3 specular = Ks * specularColor * highlight; // specular term
            
    // combine to find lit color
    vec3 litColor = ambient + diffuse + specular;
    
    gl_FragColor = vec4(litColor, 1.0);
    
    // only ambient
    if(mode == 2) gl_FragColor = vec4(ambient, 1.0);
    // only diffuse
    if(mode == 3) gl_FragColor = vec4(diffuse, 1.0);
    // only specular
    if(mode == 4) gl_FragColor = vec4(specular, 1.0);
} // end main
</textarea>

</body>
</html>
